services:
  tailscale:
    image: "ghcr.io/tailscale/tailscale:v1.90.6"
    container_name: tailscale
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
      - SYS_ADMIN
      - PERFMON
    devices:
      - "/dev/net/tun:/dev/net/tun"
    privileged: true
    environment:
      TS_AUTHKEY: "${TS_AUTHKEY}"
      TS_STATE_DIR: "/var/lib/tailscale"
      TS_USERSPACE: false
      TS_EXTRA_ARGS: "--accept-dns=false --advertise-routes=${ADVERTISE_ROUTES}"
      TS_TAILSCALED_EXTRA_ARGS: "--port=${TS_TAILSCALED_EXTRA_ARGS_POST}"
    sysctls:
      net.ipv4.ip_forward: "1"
      net.ipv6.conf.all.forwarding: "1"
    volumes:
      - ./data:/var/lib/tailscale
    networks:
      default:
        ipv4_address: 172.188.0.10
    dns:
      - 172.188.0.1
    logging:
      driver: "json-file"
      options:
        max-size: "2m"
        max-file: "1"

networks:
  default:
    driver: bridge
    driver_opts:
      com.docker.network.bridge.name: tail-br0
    ipam:
      config:
        - subnet: 172.188.0.0/24
          gateway: 172.188.0.1